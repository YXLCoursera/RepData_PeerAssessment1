---
title: "Reproducible Research: Peer Assessment 1 (Alternate Submission)"
author: "Yaxin Li"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output:
  html_document:
    self_contained: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  fig.path = "figure/"   # <-- this creates figure/ next to your Rmd
)
```

## Loading and preprocessing the data

```{r load-prep}
# Per instructions: activity.csv is in the same folder and not zipped
stopifnot(file.exists("activity.csv"))

dat <- read.csv("activity.csv", stringsAsFactors = FALSE)

# Parse/convert columns
dat$date <- as.Date(dat$date)              # YYYY-MM-DD
dat$interval <- as.integer(dat$interval)
dat$steps <- as.numeric(dat$steps)

# Basic checks
str(dat)
summary(dat)
head(dat, 10)
```

## What is mean total number of steps taken per day?

For this part of the assignment, missing values in `steps` are ignored.

```{r totals-per-day}
dat_nonmissing <- dat[!is.na(dat$steps), ]

daily_totals <- aggregate(steps ~ date, data = dat_nonmissing, FUN = sum)
colnames(daily_totals) <- c("date", "total_steps")

head(daily_totals)
summary(daily_totals$total_steps)
```

### Histogram of the total number of steps taken each day

```{r hist-daily, fig.width=7.5, fig.height=4.8}
# Different look: colored histogram with borders
hist(
  daily_totals$total_steps,
  breaks = 18,
  col = "#4C78A8",          # blue fill
  border = "white",
  main = "Distribution of Daily Step Totals (NAs Ignored)",
  xlab = "Total steps per day",
  ylab = "Frequency"
)
```

### Mean and median total steps per day

```{r mean-median-daily}
mean_daily <- mean(daily_totals$total_steps)
median_daily <- median(daily_totals$total_steps)

mean_daily
median_daily
```

## What is the average daily activity pattern?

```{r avg-pattern}
avg_by_interval <- aggregate(steps ~ interval, data = dat_nonmissing, FUN = mean)
colnames(avg_by_interval) <- c("interval", "avg_steps")

head(avg_by_interval)
```

### Time series plot of average steps across all days

```{r ts-avg-pattern, fig.width=8, fig.height=4.6}
# Different plot style: base line + points, custom colors
plot(
  avg_by_interval$interval,
  avg_by_interval$avg_steps,
  type = "l",
  lwd = 2,
  col = "#1B9E77",          # green line
  main = "Average Steps per 5-minute Interval",
  xlab = "5-minute interval",
  ylab = "Average steps"
)
points(
  avg_by_interval$interval,
  avg_by_interval$avg_steps,
  pch = 16,
  cex = 0.4,
  col = "#1B9E77"
)
```

### 5-minute interval containing the maximum number of steps (on average)

```{r max-interval}
max_row <- avg_by_interval[which.max(avg_by_interval$avg_steps), , drop = FALSE]
max_row
```

## Imputing missing values

### Total number of missing values in the dataset

```{r count-missing}
n_missing <- sum(is.na(dat$steps))
n_missing
```

### Imputation strategy and new dataset

**Strategy (different attempt):** impute missing `steps` using the **median** number of steps for the same `interval`
(calculated over all non-missing observations). This is simple and robust to spikes.

```{r impute}
median_by_interval <- tapply(dat$steps, dat$interval, median, na.rm = TRUE)

dat_imp <- dat
dat_imp$steps_imp <- dat_imp$steps

miss_idx <- is.na(dat_imp$steps_imp)
dat_imp$steps_imp[miss_idx] <- median_by_interval[as.character(dat_imp$interval[miss_idx])]

# Confirm imputation worked
sum(is.na(dat_imp$steps_imp))
```

### Histogram of daily totals after imputation

```{r totals-after-impute}
daily_totals_imp <- aggregate(steps_imp ~ date, data = dat_imp, FUN = sum)
colnames(daily_totals_imp) <- c("date", "total_steps_imp")

head(daily_totals_imp)
summary(daily_totals_imp$total_steps_imp)
```

```{r hist-after-impute, fig.width=7.5, fig.height=4.8}
hist(
  daily_totals_imp$total_steps_imp,
  breaks = 18,
  col = "#F58518",          # orange fill
  border = "white",
  main = "Distribution of Daily Step Totals (After Imputation)",
  xlab = "Total steps per day",
  ylab = "Frequency"
)
```

### Mean/median after imputation and comparison

```{r mean-median-after}
mean_daily_imp <- mean(daily_totals_imp$total_steps_imp)
median_daily_imp <- median(daily_totals_imp$total_steps_imp)

mean_daily_imp
median_daily_imp

impact <- data.frame(
  Metric = c("Mean", "Median"),
  Before_Impute = c(mean_daily, median_daily),
  After_Impute  = c(mean_daily_imp, median_daily_imp),
  Difference    = c(mean_daily_imp - mean_daily,
                    median_daily_imp - median_daily)
)

impact

# Nicely printed table (still fully reproducible)
knitr::kable(impact, digits = 2)
```

## Are there differences in activity patterns between weekdays and weekends?

Use the **imputed** dataset for this section.

```{r daytype}
# Locale-independent weekday/weekend classification:
# as.POSIXlt()$wday: 0 = Sunday, ..., 6 = Saturday
wday <- as.POSIXlt(dat_imp$date)$wday

dat_imp$day_type <- ifelse(wday %in% c(0, 6), "weekend", "weekday")
dat_imp$day_type <- factor(dat_imp$day_type, levels = c("weekday", "weekend"))

table(dat_imp$day_type)
```

### Panel plot comparing average steps per interval across weekdays and weekends

```{r panel-data}
avg_int_day <- aggregate(steps_imp ~ interval + day_type, data = dat_imp, FUN = mean)
colnames(avg_int_day) <- c("interval", "day_type", "avg_steps_imp")

head(avg_int_day)
```

```{r panel-plot, fig.width=9, fig.height=5.2}
# Different plotting system + color scheme: ggplot2 facets
library(ggplot2)

ggplot(avg_int_day, aes(x = interval, y = avg_steps_imp, color = day_type)) +
  geom_line(linewidth = 0.8) +
  facet_wrap(~ day_type, ncol = 1) +
  scale_color_manual(values = c("weekday" = "#4C78A8", "weekend" = "#E45756")) +
  labs(
    title = "Average Steps per 5-minute Interval: Weekdays vs Weekends",
    x = "5-minute interval",
    y = "Average steps (imputed dataset)",
    color = "Day type"
  ) +
  theme_minimal(base_size = 12) +
  theme(legend.position = "none")
```
